import{_ as h,g as l,m as r,s as d,x as b,L as x,f as u,l as i,k as U,j as m,y as w,z as g}from"./index-36a60a37.js";import{A as k,g as D}from"./Artplayer-e114ec4f.js";import{b as L}from"./browser-87061074.js";import{v as f}from"./video.service-107942f6.js";import{a as c}from"./myAlert-34166312.js";const V={components:{},props:{src:""},data(){return{option:{controls:[],autoplay:!0}}},mounted(){}},S=["src"];function C(t,e,a,y,o,p){return l(),r("div",null,[d("video",{src:a.src},null,8,S)])}const E=h(V,[["render",C]]),O="/Mtube/assets/upload_illustration-ccba92d1.svg";const N={setup(){return{accountStore:b()}},props:{videoEdit:{type:Object}},components:{VideoController:E,Loading:x,Artplayer:k},data(){return{urlVideoLocal:"",title:"",formData:{videoUpload:{url:""}},video:null,isLoading:!1,fullPage:!0,onCancel:!1,showOptions:!1,option:{autoplay:!1,pip:!0,screenshot:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,airplay:!0,theme:"#4e2a7d"},loading:{isLoading:!1,isFullPage:!1,onCancel:!1}}},methods:{onChangeFile(t){this.video=t.target.files[0],URL.revokeObjectURL(this.formData.videoUpload.url),this.formData.videoUpload.url=URL.createObjectURL(t.target.files[0]),setTimeout(()=>{this.showOptions=!0},100)},async handleUpload(){try{if(this.formData._id){this.handleEdit();return}this.loading.isLoading=!0;var t=JSON.parse(JSON.stringify(this.formData));"tags"in t&&(t.tags=t.tags.split(","),t.tags=t.tags.filter(a=>a.trim()!==""),t.tags.forEach(a=>{console.log("ðŸš€ ~ file: UploadVideo.vue:197 ~ data.tags.forEach ~ tags:",a)}));const e=new L;if(e.append("accountId",this.accountStore.account._id),e.append("publishedAt",D()),e.append("channelTitle",this.accountStore.account.name),e.append("title",t.title.trim()),e.append("video",this.video),t.description&&e.append("description",t.description),t.tags)for(let a=0;a<t.tags.length;a++)e.append(`tags[${a}]`,t.tags[a]);e.append("region",t.region),e.append("allowComment",t.allowComment),e.append("category",t.category),await f.create(e),this.loading.isLoading=!1,c.myAlert("success","Successfully uploaded video"),URL.revokeObjectURL(this.formData.videoUpload.url),this.$router.push({name:"home"})}catch(e){console.log("ðŸš€ ~ file: UploadVideo.vue:242 ~ handleUpload ~ error:",e),c.myAlert("error",e.response.data||e.response.data.message||e.message||e),this.loading.isLoading=!1}},async handleEdit(){try{this.loading.isLoading=!0,await f.update(this.formData._id,this.formData),this.loading.isLoading=!1,c.myAlert("success","Successfully Edit video"),this.$router.push({name:"detail",params:{id:this.formData._id}})}catch(t){console.error(t),c.myAlert("error",t.response.data.message||t.message),this.loading.isLoading=!1}}},mounted(){this.$route.query.videoEdit&&(this.formData=JSON.parse(this.$route.query.videoEdit),this.showOptions=!0)}},A={class:"row justify-content-center align-items-center p-3 main_container"},R={class:"row gap-2 justify-content-center align-items-center"},j={class:"col-12 col-xl-5 rounded-2 p-3 d-flex flex-column justify-content-center align-items-center",style:{"background-color":"var(--bg_form)"}},F={key:0,src:O,alt:""},P={key:0,class:"col-12 col-xl-5 rounded-2 d-flex justify-content-center align-items-center",style:{"background-color":"var(--bg_form)"}},B={class:"p-3",style:{width:"90%"}},T=d("h2",null,"Detail",-1),q={stype:"submit ",class:"col-4 py-2 rounded-3",style:{"background-color":"var(--btn)",color:"var(--text)"}},z={key:0},J={key:1};function M(t,e,a,y,o,p){const v=u("Artplayer"),s=u("FormKit"),_=u("loading");return l(),r("div",A,[i(s,{type:"form",modelValue:o.formData,"onUpdate:modelValue":e[1]||(e[1]=n=>o.formData=n),actions:!1,onSubmit:e[2]||(e[2]=n=>p.handleUpload())},{default:U(()=>[d("div",R,[d("div",j,[o.showOptions?(l(),m(v,{key:o.formData.videoUpload.url,option:{...o.option,url:o.formData.videoUpload.url},class:"mb-3 overflow-hidden",style:w({height:"60vh",width:"100%",borderRadius:"var(--border_radius_video)"})},null,8,["option","style"])):(l(),r("img",F)),this.formData._id?g("",!0):(l(),m(s,{key:2,type:"file",label:"Select a video as you would like",accept:".mp4",name:"file",multiple:"false",help:"Note: File size is less than 20MB",onChange:p.onChangeFile},null,8,["onChange"]))]),o.showOptions?(l(),r("div",P,[d("div",B,[T,i(s,{type:"text",name:"title",label:"Title",validation:"required",maxlength:"200",modelValue:o.title,"onUpdate:modelValue":e[0]||(e[0]=n=>o.title=n)},null,8,["modelValue"]),i(s,{type:"textarea",name:"description",rows:"10",label:"Description",placeholder:"Enter your description..."}),i(s,{type:"select",label:"Which category is this video?",name:"category",options:["Cars and vehicles","Comedy","Education","Film and animation","Gaming","How-to and style","Music","News and politics","Non-profits and activism","People and blogs","Pets and animals","Science and technology","Sport","Travel and events"]}),i(s,{type:"text",name:"region",label:"Region",value:"VN",validation:"required",maxlength:"2",placeholder:"Ex: 'VietNam' -> 'VN'"}),i(s,{type:"textarea",name:"tags",label:"Tags",maxlength:"500",placeholder:"Ex: title1,title2,..."}),i(s,{type:"checkbox",label:"Allow comment",name:"allowComment",value:!0,"validation-visibility":"dirty"}),d("button",q,[this.formData._id?(l(),r("span",z,"Save")):(l(),r("span",J,"Upload"))])])])):g("",!0)])]),_:1},8,["modelValue"]),i(_,{active:o.loading.isLoading,"onUpdate:active":e[3]||(e[3]=n=>o.loading.isLoading=n),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.6,loader:"bars","is-full-page":o.loading.isFullPage},null,8,["active","is-full-page"])])}const H=h(N,[["render",M]]);export{H as default};
