import{v}from"./video.service-107942f6.js";import{J as z,_ as B,x as R,A as U,L as j,K as F,S as M,f as m,g as n,m as l,s,t as r,j as f,k as y,l as p,z as c,G as q,M as H,F as K,q as Y,u as S,D as N,E as T,N as G,H as J,B as W,y as L,C,T as D}from"./index-36a60a37.js";import{g as Q,a as E,c as V,A as X}from"./Artplayer-e114ec4f.js";import{V as Z}from"./VideoCard-ff756b34.js";import{a as O}from"./myAlert-34166312.js";import{P as $}from"./ProfileCard-131b0e33.js";class ee{constructor(t="https://alive-visor.cyclic.app/comment"){this.api=z(t)}async getAll(t){return(await this.api.get(`/${t}`)).data}async create(t){return(await this.api.post("/",t)).data}async deleteAll(){return(await this.api.delete("/")).data}async get(t){return(await this.api.get(`/one/${t}`)).data}async update(t,a){return(await this.api.put(`/${t}`,a)).data}async delete(t){return(await this.api.delete(`/one/${t}`)).data}}const x=new ee;const te={setup(){const e=R(),t=U();return{accountStore:e,extraStore:t}},props:{video:{type:Object},accountId:{type:String}},components:{Loading:j,AvatarCircle:F},data(){return{isLoading:!1,fullPage:!1,comments:[],content:"",commentOfUser:{videoId:this.video._id,accountId:this.accountStore.account._id,textOriginal:"",publishedAt:Q()}}},computed:{},methods:{async getComments(){try{this.comments=(await x.getAll(this.video._id)).map(e=>{const t=`${E(e.publishedAt)}, ${V(e.publishedAt)}`;return{...e,publishedAt:t}})}catch(e){console.log(e)}},async handleComment(e){e.key==="Enter"&&e.shiftKey?(this.content+=`
`,e.preventDefault()):e.key==="Enter"&&await this.addComment()},async addComment(){try{if(this.commentOfUser.textOriginal.trim().length==0)return;this.isLoading=!0,await x.create(this.commentOfUser),await this.getComments(),this.isLoading=!1,this.content="",this.keepScroll()}catch(e){console.log("🚀 ~ file: Comment.vue:184 ~ addComment ~ err:",e),this.isLoading=!1,this.extraStore.myAlert("error",e.response.data.message||"Add comment failed!")}},async deleteComment(e){if(await this.extraStore.myConfirm("Are you sure?","warning","You won't be able to revert this!","Yes, delete it!"))try{this.isLoading=!0,await x.delete(e._id);for(let a=0;a<this.comments.length;a++)if(this.comments[a]._id===e._id){this.comments.splice(a,1);break}this.keepScroll(),this.isLoading=!1}catch{this.isLoading=!1,M.fire({position:"top",icon:"error",title:"Error",text:"Can't delete comment! 😭",showConfirmButton:!1,timer:1500})}},keepScroll(){var e=document.querySelector("#main");e.scrollTop=e.scrollHeight}},watch:{content(){this.commentOfUser.textOriginal=this.content}},async mounted(){await this.getComments()}},A=e=>(N("data-v-e37dc95a"),e=e(),T(),e),oe={class:"",style:{"background-color":"var(--background_main)"}},se={class:"fs-5"},ie={class:"input-group my-4 pt-md-2 d-flex align-items-center"},ne=A(()=>s("i",{class:"fa-solid fa-paper-plane p-2"},null,-1)),ae=[ne],le={id:"comment",class:"container-fluid overflow-auto m-0 p-0 vl-parent",style:{"overflow-x":"hidden !important"}},ce={class:"p-0 position-relative"},re={class:"col-10 col-sm-11"},de={class:"d-flex flex-column flex-sm-row align-items-start justify-content-center gap-sm-3"},ue={class:"d-flex flex-column justify-content-start"},me={class:"px-2",style:{color:"var(--text_white_50)","font-size":"0.8rem","font-weight":"300"}},he={key:0,class:"px-2 m-0 fw-light",style:{"font-size":"0.8rem"}},pe=["onClick"],_e=A(()=>s("i",{class:"fa-solid fa-trash-can"},null,-1)),ve=[_e],fe=A(()=>s("hr",{class:"m-0"},null,-1));function ye(e,t,a,h,o,u){const g=m("AvatarCircle"),w=m("router-link"),b=m("loading");return n(),l("div",oe,[s("p",se,r(o.comments.length)+" comments",1),s("div",ie,[h.accountStore.account._id?(n(),f(w,{key:0,to:{name:"profile",params:{accountId:h.accountStore.account._id}}},{default:y(()=>[p(g,{class:"mx-3",src:h.accountStore.account.avatar.url},null,8,["src"])]),_:1},8,["to"])):c("",!0),q(s("textarea",{type:"text",class:"form-control rounded-3 me-2 h-100 fs-5",placeholder:"Add a comment...","aria-label":"Bình luận về video","onUpdate:modelValue":t[0]||(t[0]=i=>o.content=i),onKeydown:t[1]||(t[1]=(...i)=>u.handleComment&&u.handleComment(...i))},null,544),[[H,o.content]]),s("button",{class:"rounded-1 h-100 text-center","data-bs-toggle":"modal",type:"button",onClick:t[2]||(t[2]=i=>u.addComment())},ae)]),s("div",le,[(n(!0),l(K,null,Y(o.comments,(i,k)=>(n(),l("div",{key:k,class:"row align-items-center"},[s("div",ce,[s("div",re,[i.accountId?(n(),f(w,{key:0,to:{name:"profile",params:{accountId:i.accountId._id}},class:"d-flex gap-2 my-2 align-items-center"},{default:y(()=>[p(g,{src:i.accountId.avatar.url},null,8,["src"]),s("div",de,[s("div",ue,[s("span",{class:S(["fs-sm-5 px-2 rounded-5",i.accountId._id===this.accountId?"isAccount":""])},r(i.accountId.name),3),s("span",me,r(i.accountId.followers.length.toLocaleString("en-US"))+" followers ",1)]),i.publishedAt?(n(),l("p",he,r(i.publishedAt),1)):c("",!0)])]),_:2},1032,["to"])):c("",!0),(n(),l("p",{class:"text-break my-2",style:{"white-space":"pre-line"},key:k},r(i.textOriginal),1))]),a.accountId===this.accountStore.account._id||i.accountId._id==h.accountStore.account._id?(n(),l("button",{key:0,class:"rounded-2 p-0 position-absolute top-50 end-0 translate-middle-y",onClick:I=>u.deleteComment(i),style:{height:"30px",width:"40px"}},ve,8,pe)):c("",!0)]),fe]))),128)),p(b,{active:o.isLoading,"onUpdate:active":t[3]||(t[3]=i=>o.isLoading=i),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.8,loader:"bars","is-full-page":o.fullPage},null,8,["active","is-full-page"])])])}const ge=B(te,[["render",ye],["__scopeId","data-v-e37dc95a"]]),P=e=>(e=Number(e).toLocaleString("en-US"),e);const we={setup(){const e=R(),t=U();return{accountStore:e,extraStore:t}},components:{Navigation:G,Header:J,Comment:ge,Loading:j,VideoCard:Z,Artplayer:X,AvatarCircle:F,ProfileCard:$},props:{id:{type:String,required:!0}},data(){return{video:{type:Object,required:!0},relaviteVideos:[],urlVideo:"",liked:{type:Boolean},loading:{isLoading:!0,isFullPage:!1},accountId:this.accountStore.account._id,isShow:!1,avatarChannel:"",allowComment:{type:Boolean},option:{autoplay:!1,pip:!0,screenshot:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,airplay:!0,theme:"#4e2a7d"},style:{width:"100%",height:"480px",marginBottom:"1rem"},optionRelativeVideo:{autoplay:!1},styleRelativeVideo:{width:"100%",height:"120px",borderRadius:"15px"}}},methods:{async getVideo(){try{this.video=await v.get(this.id),this.urlVideo=this.video.videoUpload.url,this.option.url=this.urlVideo,this.allowComment=this.video.allowComment,this.video.viewCount=P(this.video.viewCount),this.video.likeCount=P(this.video.likeCount),this.checkLiked()}catch(e){console.log(e)}},async getRelativeVideo(){try{const e=this.video.category,t=await v.getAll();this.relaviteVideos=t.filter(a=>a.category===e&&a._id!==this.video._id),this.relaviteVideos=this.relaviteVideos.map(a=>{const h=V(a.publishedAt);return{...a,publishedAt:h}})}catch(e){console.log("🚀 ~ file: DetailVideo.vue:231 ~ getRelativeVideo ~ error:",e)}},async addFavoriteVideo(e){try{(await W.addFavoriteVideo(this.accountStore.account._id,e)).added?O.myAlert("success","Added into your 'My Videos'"):O.myAlert("error","This Video exist in your 'My Videos'")}catch(t){console.log("🚀 ~ file: DetailVideo.vue:322 ~ addFavoriteVideo ~ error:",t)}},checkLiked(){this.liked=this.video.usersLike.includes(this.accountId)},async handleLike(){try{this.liked=!this.liked,this.video=await v.update(this.id,{accountId:this.accountId,like:this.liked}),this.checkLiked(),this.formatPublishAt()}catch(e){console.log("🚀 ~ file: DetailVideo.vue:309 ~ handleLike ~ error:",e)}},async handleAllowComment(){try{this.allowComment=!this.allowComment,this.video=await v.update(this.id,{allowComment:this.allowComment})}catch(e){console.log("🚀 ~ file: DetailVideo.vue:313 ~ handleAllowComment ~ error:",e)}},async addView(){try{this.video=await v.update(this.id,{viewCount:Number(this.video.viewCount)+1})}catch(e){console.log("🚀 ~ file: DetailVideo.vue:324 ~ addView ~ error:",e)}},formatPublishAt(){this.video.publishedAt=`${E(this.video.publishedAt)}, ${V(this.video.publishedAt)}`}},computed:{},async created(){await this.getVideo(),await this.addView(),await this.getRelativeVideo(),this.formatPublishAt(),this.loading.isLoading=!1}},d=e=>(N("data-v-04787106"),e=e(),T(),e),ke={key:0,class:"row text-break vl-parent px-sm-5",style:{"background-color":"var(--background_main)"}},Ce={class:"col-12 col-lg-7 col-xl-8",style:{"background-color":"var(--background_main)"}},be={class:""},xe={class:"p-0 fs-4"},Se={class:""},Ve={class:""},Ae={class:"w-100 d-flex flex-column flex-sm-row justify-content-around align-items-center my-4 gap-2 text-center"},Ie={class:"d-flex gap-5 align-items-center justify-content-between justify-content-sm-start col-12 col-sm-9"},Le={class:"fs-5"},De=d(()=>s("i",{class:"fa-solid fa-eye btn-reacte rounded-4"},null,-1)),Oe={class:"fs-5"},Pe={key:0},Be={class:"fs-5"},Re=d(()=>s("span",null,"Favorite",-1)),Ue={key:0},je=d(()=>s("span",{class:"me-2"},"Less",-1)),Fe=d(()=>s("i",{class:"fa-solid fa-caret-up"},null,-1)),Ne=[je,Fe],Te={key:1},Ee=d(()=>s("span",{class:"me-2"},"More",-1)),ze=d(()=>s("i",{class:"fa-solid fa-caret-down"},null,-1)),Me=[Ee,ze],qe={class:"row justify-content-center"},He={key:0,class:"rounded-2 p-3 mb-3",style:{"background-color":"var(--bg_detail_video)"}},Ke={class:""},Ye=d(()=>s("i",{class:"fa-solid fa-calendar-days"},null,-1)),Ge={key:0,style:{"white-space":"pre-line"}},Je={key:1,class:"float-end d-flex gap-2 align-items-center"},We=d(()=>s("span",null,"Allow comment",-1)),Qe={class:"switch"},Xe=["checked"],Ze=d(()=>s("span",null,null,-1)),$e={key:1,class:"col-sm-12 my-4"},et={key:2,class:"col-sm-12 my-4 text-center"},tt=d(()=>s("span",{class:"fs-5"},"Blocked comment",-1)),ot=[tt],st={class:"col-12 col-lg-5 col-xl-4 p-0 m-0"};function it(e,t,a,h,o,u){const g=m("Artplayer"),w=m("ProfileCard"),b=m("RouterLink"),i=m("Comment"),k=m("VideoCard"),I=m("loading");return o.video?(n(),l("div",ke,[s("div",Ce,[o.urlVideo?(n(),f(g,{key:0,option:o.option,style:L(o.style)},null,8,["option","style"])):c("",!0),s("div",be,[s("p",xe,r(o.video.title),1),s("div",Se,[s("p",Ve,[o.video.accountId?(n(),f(b,{key:0,to:{name:"profile",params:{accountId:o.video.accountId._id}}},{default:y(()=>[p(w,{account:o.video.accountId},null,8,["account"])]),_:1},8,["to"])):c("",!0)]),s("div",Ae,[s("div",Ie,[s("div",Le,[De,C("  "),s("span",null,r(o.video.viewCount),1)]),s("div",Oe,[s("i",{class:S(["fa-solid fa-heart btn-reacte rounded-4",{like:o.liked}]),onClick:t[0]||(t[0]=_=>u.handleLike())},null,2),C("  "),o.video.usersLike?(n(),l("span",Pe,r(o.video.usersLike.length),1)):c("",!0)]),s("div",Be,[s("i",{class:"fa-solid fa-folder-plus btn-reacte rounded-4",onClick:t[1]||(t[1]=_=>u.addFavoriteVideo(o.video._id))}),C("  "),Re])]),s("button",{class:"col-3 p-2 mb-3 text-center rounded-3 fs-5",style:{"background-color":"var(--btn)",color:"var(--text)"},onClick:t[2]||(t[2]=_=>o.isShow=!o.isShow)},[o.isShow?(n(),l("span",Ue,Ne)):(n(),l("span",Te,Me))])]),s("div",qe,[p(D,{name:"bounce"},{default:y(()=>[o.isShow?(n(),l("div",He,[s("p",Ke,[Ye,C("  "+r(o.video.publishedAt),1)]),o.video.description&&o.video.description!=="undefined"?(n(),l("p",Ge,r(o.video.description),1)):c("",!0)])):c("",!0)]),_:1})])])]),o.video.accountId&&o.video.accountId._id===h.accountStore.account._id?(n(),l("div",Je,[We,s("label",Qe,[s("input",{type:"checkbox",checked:o.allowComment,onClick:t[3]||(t[3]=(..._)=>u.handleAllowComment&&u.handleAllowComment(..._))},null,8,Xe),Ze])])):c("",!0),p(D,{name:"bounce"},{default:y(()=>[o.video.allowComment&&o.allowComment?(n(),l("div",$e,[(n(),f(i,{key:o.video._id,video:o.video,accountId:o.video.accountId._id},null,8,["video","accountId"]))])):(n(),l("div",et,ot))]),_:1})]),s("div",st,[p(k,{class:S(this.$route.name==="detail"?"customArtplayer":""),videos:o.relaviteVideos,option:o.optionRelativeVideo,style:L(o.styleRelativeVideo)},null,8,["class","videos","option","style"])]),p(I,{active:o.loading.isLoading,"onUpdate:active":t[4]||(t[4]=_=>o.loading.isLoading=_),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.6,loader:"bars","is-full-page":o.loading.isFullPage},null,8,["active","is-full-page"])])):c("",!0)}const ut=B(we,[["render",it],["__scopeId","data-v-04787106"]]);export{ut as default};
