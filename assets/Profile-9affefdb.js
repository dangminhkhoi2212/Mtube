import{_ as S,x as L,K as A,L as U,B as h,f as p,g as n,m as c,z as r,y as g,s as t,j as y,F as E,q as P,l as v,k,T as j,G as f,M as m,u as I,t as d,C as b,D as R,E as B}from"./index-3d315587.js";import{V as z}from"./VideoCard-0c0f0d4d.js";import{c as C,a as M}from"./Artplayer-0c35b067.js";import{a as u}from"./myAlert-a77212b8.js";import{d as T}from"./ChatEngine-101d00b0.js";import{P as N}from"./ProfileCard-19babffb.js";const O={setup(){return{accountStore:L()}},props:{accountId:{type:String}},components:{AvatarCircle:A,VideoCard:z,Loading:U,ProfileCard:N},data(){return{account:{},option:{},style:{width:"100%",height:"180px",borderRadius:"var(--border_radius_video)"},newCover:null,coverUrl:"",oldCoverUrl:"",navFields:["Videos","About","Settings"],activeField:this.$route.query.chooseField||"Videos",totalFollowers:[],joined:"",password:null,isEditDetails:!1,isUpdateCover:!1,isDeleteAccount:!1,isProfile:this.accountId===this.accountStore.account._id,loading:{isLoading:!0,isfullPage:!1,onCancel:!1}}},watch:{},methods:{async getProfile(){try{this.account=await h.getAccount(this.accountId),this.coverUrl=this.account.cover.url,this.oldCoverUrl=this.account.cover.url,this.totalFollowers=this.account.followers,this.formatDateVideo(),this.formatJoined()}catch(s){console.log("ðŸš€ ~ file: Profile.vue:31 ~ getProfile ~ error:",s)}},formatDateVideo(){this.account.myVideos=this.account.myVideos.map(s=>(s.publishedAt=C(s.publishedAt),s))},formatJoined(){this.joined=`${M(this.account.join)}, ${C(this.account.join)}`},getTotalViews(){if(this.account.myVideos.length>0){var s=0;return this.account.myVideos.forEach(o=>{s+=o.viewCount}),s}return 0},async handleFollow(s){try{const o=this.accountStore.account._id,_=this.accountId;o!==_&&(this.account=await h.handleFollow(o,_,s),this.totalFollowers=this.account.followers,this.formatDateVideo())}catch(o){console.log("ðŸš€ ~ file: Profile.vue:192 ~ follow ~ error:",o)}},async removeMyVideo(s){if(await u.myConfirm("Are you sure?","warning","You won't be able to revert this!","Yes, delete it!"))try{this.loading.isLoading=!0,this.account=await h.removeMyVideo(this.accountStore.account._id,s),this.formatDateVideo(),u.myAlert("success","Your video has been deleted."),this.loading.isLoading=!1}catch{u.myAlert("Error!","Don't delete this video! "),this.loading.isLoading=!1}},async handleEditDetails(){try{this.isEditDetails=!0,this.loading.isLoading=!0;const{biography:s,media:o}=this.account;this.account=await h.update(this.account._id,{biography:s,media:o}),this.formatDateVideo(),u.myAlert("success","Your video has been deleted."),this.isEditDetails=!1,this.loading.isLoading=!1}catch{this.loading.isLoading=!1,u.myAlert("error","Don't update detail this video! ")}},handleButtonClick(){this.$refs.file.click(),this.isUpdateCover=!0},onFileSelected(s){s.target.files[0]&&(this.newCover=s.target.files[0],URL.revokeObjectURL(this.newCover),this.coverUrl=URL.createObjectURL(s.target.files[0]))},handleCancelFile(){this.isUpdateCover=!1,this.coverUrl=this.oldCoverUrl},async updateCover(){try{this.loading.isLoading=!0,this.isUpdateCover=!1;const s=new FormData;s.append("image",this.newCover),s.append("selectImage","cover"),this.account=await h.update(this.accountStore.account._id,s),this.formatDateVideo(),URL.revokeObjectURL(this.coverUrl),this.loading.isLoading=!1}catch{this.loading.isLoading=!1,u.myAlert("error","Error while updating")}},changeNavFields(s){this.activeField=s},async deleteAccount(){try{if(this.isDeleteAccount&&!this.password)return;this.loading.isLoading=!0,await h.delete(this.accountStore.account._id,this.password),await T(this.accountStore.account.username,this.accountStore.account._id),this.accountStore.account=null,localStorage.clear(),this.loading.isLoading=!1,this.$router.push({name:"login"})}catch(s){this.loading.isLoading=!1,u.myAlert("error",s.response.data.message)}}},async created(){await this.getProfile(),this.loading.isLoading=!1},async mounted(){this.chooseField&&(this.activeField=this.chooseField),this.isProfile||(this.navFields=this.navFields.filter(s=>s!=="Settings"))}},l=s=>(R("data-v-05d194fc"),s=s(),B(),s),Y={key:0,class:"px-md-5 vl-parent position-relative"},q={class:"position-absolute bottom-0 mb-2 px-2"},J=l(()=>t("i",{class:"fa-solid fa-camera"},null,-1)),G=[J],K={key:1,class:"position-absolute bottom-0 end-0"},H={class:"py-4"},Q={class:"d-flex flex-column sticky-top h-100",style:{"background-color":"var(--background_main)","z-index":"calc(var(--z_index_nav))"}},W={class:"d-flex"},X=["onClick"],Z=l(()=>t("hr",{class:"m-0 p-0"},null,-1)),$={key:1},ee={class:"",key:2},te={class:"row row-cols-1 row-cols-md-3 py-3"},oe={class:"col"},se=l(()=>t("h5",null,"Joined",-1)),ie=l(()=>t("hr",null,null,-1)),ne={class:"col"},le=l(()=>t("h5",null,"Total views",-1)),ce=l(()=>t("hr",null,null,-1)),ae={class:"col"},re=l(()=>t("h5",null,"Following",-1)),de=l(()=>t("hr",null,null,-1)),ue={class:"row"},he=l(()=>t("h5",null,"Biography",-1)),fe=l(()=>t("hr",null,null,-1)),me={class:"row"},_e=l(()=>t("h5",null,"Media",-1)),pe={class:"d-flex flex-column justify-content-start gap-2 overflow-hidden"},ve={class:"d-flex gap-2 align-items-center"},ge=["href"],ye=l(()=>t("i",{class:"fs-3 rounded-5 p-2 fa-brands fa-facebook"},null,-1)),ke=[ye],be=["title"],Ce={class:"d-flex gap-2 align-items-center"},we=["href"],xe=l(()=>t("i",{class:"fs-3 rounded-5 p-2 fa-brands fa-instagram"},null,-1)),De=[xe],Ve=["title"],Fe={class:"d-flex gap-2 align-items-center"},Se=["href"],Le=l(()=>t("i",{class:"fs-3 rounded-5 p-2 fa-brands fa-tiktok"},null,-1)),Ae=[Le],Ue=["title"],Ee=l(()=>t("hr",{class:"my-2"},null,-1)),Pe={class:"d-flex justify-content-center gap-2 mt-4"},je=["title"],Ie=l(()=>t("i",{class:"fs-4 mx-2 fa-regular fa-pen-to-square"},null,-1)),Re=l(()=>t("span",null,[t("i",{class:"fs-4 mx-2 fa-solid fa-xmark"})],-1)),Be=[Re],ze=l(()=>t("i",{class:"fs-4 mx-2 fa-solid fa-cloud-arrow-up"},null,-1)),Me={key:3,class:"row col-12 col-sm-6"},Te={class:"d-flex justify-content-between align-items-center py-2 mt-2"},Ne=l(()=>t("h5",null,"Edit Account",-1)),Oe=l(()=>t("button",{class:"btn"},"Go to Edit",-1)),Ye=l(()=>t("hr",null,null,-1)),qe={class:"d-flex justify-content-between align-items-center py-2"},Je=l(()=>t("h5",null,"Delete Account",-1)),Ge=l(()=>t("hr",null,null,-1)),Ke={key:2,class:"d-flex flex-column align-items-center gap-3 position-absolute top-50 start-50 translate-middle p-5 rounded-3",style:{"background-color":"var(--violet_90)","z-index":"var(--z_index_nav)"}},He=l(()=>t("h5",null,"Confirm your password",-1)),Qe={class:"d-flex justify-content-center gap-4"};function We(s,o,_,w,e,a){const x=p("ProfileCard"),D=p("VideoCard"),V=p("RouterLink"),F=p("Loading");return e.account&&w.accountStore.account?(n(),c("div",Y,[e.isDeleteAccount?(n(),c("div",{key:0,class:"space",onClick:o[0]||(o[0]=i=>e.isDeleteAccount=!e.isDeleteAccount)})):r("",!0),e.account.cover?(n(),c("div",{key:1,class:"px-md-5 position-relative",style:g([{height:"40vh"},{backgroundImage:`url(${e.coverUrl})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"}])},[t("div",q,[e.account?(n(),y(x,{key:0,account:e.account},null,8,["account"])):r("",!0)]),!e.isUpdateCover&&e.isProfile?(n(),c("button",{key:0,class:"position-absolute bottom-0 end-0 p-3 rounded-3 m-3",style:{"background-color":"var(--btn)"},onClick:o[1]||(o[1]=(...i)=>a.handleButtonClick&&a.handleButtonClick(...i))},G)):r("",!0),e.isUpdateCover&&e.isProfile?(n(),c("div",K,[t("i",{role:"button",class:"p-3 rounded-3 fa-solid fa-xmark",style:{"background-color":"var(--btn)"},onClick:o[2]||(o[2]=(...i)=>a.handleCancelFile&&a.handleCancelFile(...i))}),t("i",{role:"button",class:"p-3 m-3 rounded-3 fa-solid fa-cloud-arrow-up",style:{"background-color":"var(--btn)"},onClick:o[3]||(o[3]=(...i)=>a.updateCover&&a.updateCover(...i))})])):r("",!0),t("input",{class:"d-none",type:"file",ref:"file",accept:"image/png, image/jpeg",onChange:o[4]||(o[4]=(...i)=>a.onFileSelected&&a.onFileSelected(...i)),onCancel:o[5]||(o[5]=(...i)=>a.handleCancelFile&&a.handleCancelFile(...i))},null,544)],4)):r("",!0),t("div",H,[t("div",Q,[t("div",W,[(n(!0),c(E,null,P(e.navFields,i=>(n(),c("div",{key:i},[t("div",{role:"button",class:I(["btn fs-5",{active_btn:e.activeField===i}]),onClick:Xe=>a.changeNavFields(i)},d(i),11,X)]))),128))]),Z]),v(j,{name:"slide-fade"},{default:k(()=>[e.activeField==="Videos"?(n(),c("div",$,[(n(),y(D,{key:e.account.myVideos,class:"customArtplayer",videos:e.account.myVideos,style:g(e.style),option:e.option,onRemoveMyVideo:a.removeMyVideo},null,8,["videos","style","option","onRemoveMyVideo"]))])):e.activeField==="About"?(n(),c("div",ee,[t("div",te,[t("div",oe,[se,t("p",null,d(e.joined),1),ie]),t("div",ne,[le,t("p",null,d(a.getTotalViews()),1),ce]),t("div",ae,[re,t("p",null,d(e.account.following.length.toLocaleString("en-US")),1),de])]),t("div",ue,[he,e.isEditDetails?f((n(),c("textarea",{key:1,class:"p-2 my-2 mx-auto",style:{color:"var(--text)",height:"100px",width:"90%"},"onUpdate:modelValue":o[6]||(o[6]=i=>e.account.biography=i)},`\r
                        `,512)),[[m,e.account.biography]]):(n(),c("p",{key:e.account.biography},d(e.account.biography),1)),fe]),t("div",me,[_e,t("div",pe,[t("div",ve,[t("a",{target:"_blank",href:e.account.media.facebook},ke,8,ge),e.isEditDetails?f((n(),c("input",{key:0,type:"text","onUpdate:modelValue":o[7]||(o[7]=i=>e.account.media.facebook=i)},null,512)),[[m,e.account.media.facebook]]):(n(),c("span",{key:1,class:"text-truncate",title:e.account.media.facebook},d(e.account.media.facebook),9,be))]),t("div",Ce,[t("a",{target:"_blank",href:e.account.media.instagram},De,8,we),e.isEditDetails?f((n(),c("input",{key:0,type:"text","onUpdate:modelValue":o[8]||(o[8]=i=>e.account.media.instagram=i)},null,512)),[[m,e.account.media.instagram]]):(n(),c("span",{key:1,class:"text-truncate",title:e.account.media.instagram},d(e.account.media.instagram),9,Ve))]),t("div",Fe,[t("a",{target:"_blank",href:e.account.media.tiktok},Ae,8,Se),e.isEditDetails?f((n(),c("input",{key:0,type:"text","onUpdate:modelValue":o[9]||(o[9]=i=>e.account.media.tiktok=i)},null,512)),[[m,e.account.media.tiktok]]):(n(),c("span",{key:1,class:"text-truncate",title:e.account.media.tiktok},d(e.account.media.tiktok),9,Ue))])]),Ee]),t("div",Pe,[!e.isEditDetails&&e.isProfile?(n(),c("button",{key:0,class:"col-8 col-sm-4 px-2 py-1 rounded-3 text-center",onClick:o[10]||(o[10]=i=>e.isEditDetails=!0),style:{"background-color":"var(--btn)",color:"var(--text)"}},[t("span",{title:e.account.media.instagram},[Ie,b("Edit details ")],8,je)])):r("",!0),e.isEditDetails?(n(),c("button",{key:1,class:"rounded-2 text-center",onClick:o[11]||(o[11]=i=>e.isEditDetails=!1),style:{"background-color":"var(--btn)",color:"var(--text)"}},Be)):r("",!0),e.isEditDetails?(n(),c("button",{key:2,class:"col-5 col-sm-2 px-2 py-1 rounded-3 text-center",onClick:o[12]||(o[12]=(...i)=>a.handleEditDetails&&a.handleEditDetails(...i)),style:{"background-color":"var(--btn)",color:"var(--text)"}},[ze,b("Save ")])):r("",!0)])])):(n(),c("div",Me,[t("div",Te,[Ne,v(V,{to:{name:"editprofile"}},{default:k(()=>[Oe]),_:1})]),Ye,t("div",qe,[Je,t("button",{class:"btn",onClick:o[13]||(o[13]=i=>e.isDeleteAccount=!0)}," Delete ")]),Ge]))]),_:1})]),e.isDeleteAccount?(n(),c("div",Ke,[He,f(t("input",{type:"password",class:"p-2","onUpdate:modelValue":o[14]||(o[14]=i=>e.password=i)},null,512),[[m,e.password]]),t("div",Qe,[t("button",{class:"btn",onClick:o[15]||(o[15]=i=>e.isDeleteAccount=!1)}," Cancle "),t("button",{class:"btn",onClick:o[16]||(o[16]=(...i)=>a.deleteAccount&&a.deleteAccount(...i))},"Delete")])])):r("",!0),v(F,{active:e.loading.isLoading,"onUpdate:active":o[17]||(o[17]=i=>e.loading.isLoading=i),"can-cancel":e.loading.onCancel,"is-full-page":e.loading.isfullPage,opacity:.5,backgroundColor:"#170f23 !important",color:"#c6bcd3",loader:"bars"},null,8,["active","can-cancel","is-full-page"])])):r("",!0)}const it=S(O,[["render",We],["__scopeId","data-v-05d194fc"]]);export{it as default};
