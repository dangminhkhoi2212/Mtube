import{_ as h,g as a,m as n,s as c,x as b,L as x,f as p,l,k as w,j as f,y as k,z as m,u as S,t as U}from"./index-5856ead4.js";import{A as D,g as L}from"./Artplayer-e9d53018.js";import{F as C}from"./browser-ddd96e77.js";import{v as g}from"./video.service-78f142c5.js";import{a as d}from"./myAlert-cf6282b8.js";const V={components:{},props:{src:""},data(){return{option:{controls:[],autoplay:!0}}},mounted(){}},O=["src"];function E(e,t,i,y,o,u){return a(),n("div",null,[c("video",{src:i.src},null,8,O)])}const F=h(V,[["render",E]]),z="/Mtube/assets/upload_illustration-ccba92d1.svg";const A={setup(){return{accountStore:b()}},props:{videoEdit:{type:Object}},components:{VideoController:F,Loading:x,Artplayer:D},data(){return{urlVideoLocal:"",title:"",formData:{videoUpload:{url:""}},video:null,isLoading:!1,fullPage:!0,onCancel:!1,showOptions:!1,fileSize:0,option:{autoplay:!1,pip:!0,screenshot:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,airplay:!0,theme:"#4e2a7d"},loading:{isLoading:!1,isFullPage:!1,onCancel:!1}}},methods:{onChangeFile(e){this.video=e.target.files[0],this.fileSize=(this.video.size/(1024*1024)).toFixed(2),URL.revokeObjectURL(this.formData.videoUpload.url),this.formData.videoUpload.url=URL.createObjectURL(e.target.files[0]),setTimeout(()=>{this.showOptions=!0},100)},async handleUpload(){try{if(this.formData._id){this.handleEdit();return}if(this.fileSize>20){d.myAlert("error","File too large");return}this.loading.isLoading=!0;var e=JSON.parse(JSON.stringify(this.formData));"tags"in e&&(e.tags=e.tags.split(","),e.tags=e.tags.filter(i=>i.trim()!==""),e.tags.forEach(i=>{console.log("ðŸš€ ~ file: UploadVideo.vue:197 ~ data.tags.forEach ~ tags:",i)}));const t=new C;if(t.append("accountId",this.accountStore.account._id),t.append("publishedAt",L()),t.append("channelTitle",this.accountStore.account.name),t.append("title",e.title.trim()),t.append("video",this.video),e.description&&t.append("description",e.description),e.tags)for(let i=0;i<e.tags.length;i++)t.append(`tags[${i}]`,e.tags[i]);t.append("region",e.region),t.append("allowComment",e.allowComment),t.append("category",e.category),await g.create(t),this.loading.isLoading=!1,d.myAlert("success","Successfully uploaded video"),URL.revokeObjectURL(this.formData.videoUpload.url),this.$router.push({name:"home"})}catch{d.myAlert("error","Check file size or try again after in a few minutes"),this.loading.isLoading=!1}},async handleEdit(){try{this.loading.isLoading=!0,await g.update(this.formData._id,this.formData),this.loading.isLoading=!1,d.myAlert("success","Successfully Edit video"),this.$router.push({name:"detail",params:{id:this.formData._id}})}catch(e){d.myAlert("error",e.response.data.message||e.message),this.loading.isLoading=!1}}},mounted(){this.$route.query.videoEdit&&(this.formData=JSON.parse(this.$route.query.videoEdit),this.showOptions=!0)}},N={class:"row justify-content-center align-items-center p-3 main_container"},R={class:"row gap-2 justify-content-center align-items-center"},j={class:"col-12 col-xl-5 rounded-2 p-3 d-flex flex-column justify-content-center align-items-center",style:{"background-color":"var(--bg_form)"}},B={key:0,src:z,alt:""},P={key:0,class:"col-12 col-xl-5 rounded-2 d-flex justify-content-center align-items-center",style:{"background-color":"var(--bg_form)"}},T={class:"p-3",style:{width:"90%"}},q=c("h2",null,"Detail",-1),M={stype:"submit ",class:"col-4 py-2 rounded-3",style:{"background-color":"var(--btn)",color:"var(--text)"}},J={key:0},I={key:1};function K(e,t,i,y,o,u){const v=p("Artplayer"),s=p("FormKit"),_=p("loading");return a(),n("div",N,[l(s,{type:"form",modelValue:o.formData,"onUpdate:modelValue":t[1]||(t[1]=r=>o.formData=r),actions:!1,onSubmit:t[2]||(t[2]=r=>u.handleUpload())},{default:w(()=>[c("div",R,[c("div",j,[o.showOptions?(a(),f(v,{key:o.formData.videoUpload.url,option:{...o.option,url:o.formData.videoUpload.url},class:"mb-3 overflow-hidden",style:k({height:"60vh",width:"100%",borderRadius:"var(--border_radius_video)"})},null,8,["option","style"])):(a(),n("img",B)),this.formData._id?m("",!0):(a(),f(s,{key:2,type:"file",label:"Select a video as you would like",accept:".mp4",name:"file",multiple:"false",help:"Note: File size is less than 20MB",onChange:u.onChangeFile},null,8,["onChange"])),o.showOptions?(a(),n("span",{key:3,class:S(o.fileSize<=20?"text-success":"text-danger")},"File size: "+U(o.fileSize)+" MB",3)):m("",!0)]),o.showOptions?(a(),n("div",P,[c("div",T,[q,l(s,{type:"text",name:"title",label:"Title",validation:"required",maxlength:"200",modelValue:o.title,"onUpdate:modelValue":t[0]||(t[0]=r=>o.title=r)},null,8,["modelValue"]),l(s,{type:"textarea",name:"description",rows:"10",label:"Description",placeholder:"Enter your description..."}),l(s,{type:"select",label:"Which category is this video?",name:"category",options:["Cars and vehicles","Comedy","Education","Film and animation","Gaming","How-to and style","Music","News and politics","Non-profits and activism","People and blogs","Pets and animals","Science and technology","Sport","Travel and events"]}),l(s,{type:"text",name:"region",label:"Region",value:"VN",validation:"required",maxlength:"2",placeholder:"Ex: 'VietNam' -> 'VN'"}),l(s,{type:"textarea",name:"tags",label:"Tags",maxlength:"500",placeholder:"Ex: title1,title2,..."}),l(s,{type:"checkbox",label:"Allow comment",name:"allowComment",value:!0,"validation-visibility":"dirty"}),c("button",M,[this.formData._id?(a(),n("span",J,"Save")):(a(),n("span",I,"Upload"))])])])):m("",!0)])]),_:1},8,["modelValue"]),l(_,{active:o.loading.isLoading,"onUpdate:active":t[3]||(t[3]=r=>o.loading.isLoading=r),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.6,loader:"bars","is-full-page":o.loading.isFullPage},null,8,["active","is-full-page"])])}const Y=h(A,[["render",K]]);export{Y as default};
