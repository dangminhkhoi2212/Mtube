import{v}from"./video.service-cb433e4e.js";import{K as M,_ as R,x as U,A as j,L as F,M as N,S as q,f as m,g as n,m as l,s,t as r,j as f,k as y,l as p,z as c,G as H,O as K,F as Y,q as G,u as A,D as T,E as z,N as W,H as J,B as Q,y as O,C,T as B}from"./index-9910ee1a.js";import{g as X,a as E,c as V,A as Z}from"./Artplayer-dd8c4a58.js";import{V as $}from"./VideoCard-78312baa.js";import{a as D}from"./myAlert-99d1d29f.js";import{P as ee}from"./ProfileCard-72759367.js";const te=localStorage.getItem("token"),b={headers:{Authorization:`Bearer ${te}`}};class oe{constructor(t="https://alive-visor.cyclic.app/comment"){this.api=M(t)}async getAll(t){return(await this.api.get(`/${t}`)).data}async create(t){return(await this.api.post("/",t,b)).data}async deleteAll(){return(await this.api.delete("/",b)).data}async get(t){return(await this.api.get(`/one/${t}`)).data}async update(t,a){return(await this.api.put(`/${t}`,a,b)).data}async delete(t){return(await this.api.delete(`/one/${t}`,b)).data}}const S=new oe;const se={setup(){const e=U(),t=j();return{accountStore:e,extraStore:t}},props:{video:{type:Object},accountId:{type:String}},components:{Loading:F,AvatarCircle:N},data(){return{isLoading:!1,fullPage:!1,comments:[],content:"",commentOfUser:{videoId:this.video._id,accountId:this.accountStore.account._id,textOriginal:"",publishedAt:X()}}},computed:{},methods:{async getComments(){try{this.comments=(await S.getAll(this.video._id)).map(e=>{const t=`${E(e.publishedAt)}, ${V(e.publishedAt)}`;return{...e,publishedAt:t}})}catch(e){console.log(e)}},async handleComment(e){e.key==="Enter"&&e.shiftKey?(this.content+=`
`,e.preventDefault()):e.key==="Enter"&&await this.addComment()},async addComment(){try{if(this.commentOfUser.textOriginal.trim().length==0)return;this.isLoading=!0,await S.create(this.commentOfUser),await this.getComments(),this.isLoading=!1,this.content="",this.keepScroll()}catch(e){console.log("ðŸš€ ~ file: Comment.vue:184 ~ addComment ~ err:",e),this.isLoading=!1,this.extraStore.myAlert("error",e.response.data.message||"Add comment failed!")}},async deleteComment(e){if(await this.extraStore.myConfirm("Are you sure?","warning","You won't be able to revert this!","Yes, delete it!"))try{this.isLoading=!0,await S.delete(e._id);for(let a=0;a<this.comments.length;a++)if(this.comments[a]._id===e._id){this.comments.splice(a,1);break}this.keepScroll(),this.isLoading=!1}catch{this.isLoading=!1,q.fire({position:"top",icon:"error",title:"Error",text:"Can't delete comment! ðŸ˜­",showConfirmButton:!1,timer:1500})}},keepScroll(){var e=document.querySelector("#main");e.scrollTop=e.scrollHeight}},watch:{content(){this.commentOfUser.textOriginal=this.content}},async mounted(){await this.getComments()}},I=e=>(T("data-v-e37dc95a"),e=e(),z(),e),ie={class:"",style:{"background-color":"var(--background_main)"}},ne={class:"fs-5"},ae={class:"input-group my-4 pt-md-2 d-flex align-items-center"},le=I(()=>s("i",{class:"fa-solid fa-paper-plane p-2"},null,-1)),ce=[le],re={id:"comment",class:"container-fluid overflow-auto m-0 p-0 vl-parent",style:{"overflow-x":"hidden !important"}},de={class:"p-0 position-relative"},ue={class:"col-10 col-sm-11"},me={class:"d-flex flex-column flex-sm-row align-items-start justify-content-center gap-sm-3"},he={class:"d-flex flex-column justify-content-start"},pe={class:"px-2",style:{color:"var(--text_white_50)","font-size":"0.8rem","font-weight":"300"}},_e={key:0,class:"px-2 m-0 fw-light",style:{"font-size":"0.8rem"}},ve=["onClick"],fe=I(()=>s("i",{class:"fa-solid fa-trash-can"},null,-1)),ye=[fe],ge=I(()=>s("hr",{class:"m-0"},null,-1));function ke(e,t,a,h,o,u){const g=m("AvatarCircle"),k=m("router-link"),x=m("loading");return n(),l("div",ie,[s("p",ne,r(o.comments.length)+" comments",1),s("div",ae,[h.accountStore.account._id?(n(),f(k,{key:0,to:{name:"profile",params:{accountId:h.accountStore.account._id}}},{default:y(()=>[p(g,{class:"mx-3",src:h.accountStore.account.avatar.url},null,8,["src"])]),_:1},8,["to"])):c("",!0),H(s("textarea",{type:"text",class:"form-control rounded-3 me-2 h-100 fs-5",placeholder:"Add a comment...","aria-label":"BÃ¬nh luáº­n vá» video","onUpdate:modelValue":t[0]||(t[0]=i=>o.content=i),onKeydown:t[1]||(t[1]=(...i)=>u.handleComment&&u.handleComment(...i))},null,544),[[K,o.content]]),s("button",{class:"rounded-1 h-100 text-center","data-bs-toggle":"modal",type:"button",onClick:t[2]||(t[2]=i=>u.addComment())},ce)]),s("div",re,[(n(!0),l(Y,null,G(o.comments,(i,w)=>(n(),l("div",{key:w,class:"row align-items-center"},[s("div",de,[s("div",ue,[i.accountId?(n(),f(k,{key:0,to:{name:"profile",params:{accountId:i.accountId._id}},class:"d-flex gap-2 my-2 align-items-center"},{default:y(()=>[p(g,{src:i.accountId.avatar.url},null,8,["src"]),s("div",me,[s("div",he,[s("span",{class:A(["fs-sm-5 px-2 rounded-5",i.accountId._id===this.accountId?"isAccount":""])},r(i.accountId.name),3),s("span",pe,r(i.accountId.followers.length.toLocaleString("en-US"))+" followers ",1)]),i.publishedAt?(n(),l("p",_e,r(i.publishedAt),1)):c("",!0)])]),_:2},1032,["to"])):c("",!0),(n(),l("p",{class:"text-break my-2",style:{"white-space":"pre-line"},key:w},r(i.textOriginal),1))]),a.accountId===this.accountStore.account._id||i.accountId._id==h.accountStore.account._id?(n(),l("button",{key:0,class:"rounded-2 p-0 position-absolute top-50 end-0 translate-middle-y",onClick:L=>u.deleteComment(i),style:{height:"30px",width:"40px"}},ye,8,ve)):c("",!0)]),ge]))),128)),p(x,{active:o.isLoading,"onUpdate:active":t[3]||(t[3]=i=>o.isLoading=i),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.8,loader:"bars","is-full-page":o.fullPage},null,8,["active","is-full-page"])])])}const we=R(se,[["render",ke],["__scopeId","data-v-e37dc95a"]]),P=e=>(e=Number(e).toLocaleString("en-US"),e);const Ce={setup(){const e=U(),t=j();return{accountStore:e,extraStore:t}},components:{Navigation:W,Header:J,Comment:we,Loading:F,VideoCard:$,Artplayer:Z,AvatarCircle:N,ProfileCard:ee},props:{id:{type:String,required:!0}},data(){return{video:{type:Object,required:!0},relaviteVideos:[],urlVideo:"",liked:{type:Boolean},loading:{isLoading:!0,isFullPage:!1},accountId:this.accountStore.account._id,isShow:!1,avatarChannel:"",allowComment:{type:Boolean},option:{autoplay:!1,pip:!0,screenshot:!0,setting:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!0,mutex:!0,backdrop:!0,playsInline:!0,autoPlayback:!0,airplay:!0,theme:"#4e2a7d"},style:{width:"100%",height:"480px",marginBottom:"1rem"},optionRelativeVideo:{autoplay:!1},styleRelativeVideo:{width:"100%",height:"120px",borderRadius:"15px"}}},methods:{async getVideo(){try{this.video=await v.get(this.id),this.urlVideo=this.video.videoUpload.url,this.option.url=this.urlVideo,this.allowComment=this.video.allowComment,this.video.viewCount=P(this.video.viewCount),this.video.likeCount=P(this.video.likeCount),this.checkLiked()}catch(e){console.log(e)}},async getRelativeVideo(){try{const e=this.video.category,t=await v.getAll();this.relaviteVideos=t.filter(a=>a.category===e&&a._id!==this.video._id),this.relaviteVideos=this.relaviteVideos.map(a=>{const h=V(a.publishedAt);return{...a,publishedAt:h}})}catch(e){console.log("ðŸš€ ~ file: DetailVideo.vue:231 ~ getRelativeVideo ~ error:",e)}},async addFavoriteVideo(e){try{(await Q.addFavoriteVideo(this.accountStore.account._id,e)).added?D.myAlert("success","Added into your 'My Videos'"):D.myAlert("error","This Video exist in your 'My Videos'")}catch(t){console.log("ðŸš€ ~ file: DetailVideo.vue:322 ~ addFavoriteVideo ~ error:",t)}},checkLiked(){this.liked=this.video.usersLike.includes(this.accountId)},async handleLike(){try{this.liked=!this.liked,this.video=await v.update(this.id,{accountId:this.accountId,like:this.liked}),this.checkLiked(),this.formatPublishAt()}catch(e){console.log("ðŸš€ ~ file: DetailVideo.vue:309 ~ handleLike ~ error:",e)}},async handleAllowComment(){try{this.allowComment=!this.allowComment,this.video=await v.update(this.id,{allowComment:this.allowComment})}catch(e){console.log("ðŸš€ ~ file: DetailVideo.vue:313 ~ handleAllowComment ~ error:",e)}},async addView(){try{this.video=await v.update(this.id,{viewCount:Number(this.video.viewCount)+1})}catch(e){console.log("ðŸš€ ~ file: DetailVideo.vue:324 ~ addView ~ error:",e)}},formatPublishAt(){this.video.publishedAt=`${E(this.video.publishedAt)}, ${V(this.video.publishedAt)}`}},computed:{},async created(){await this.getVideo(),await this.addView(),await this.getRelativeVideo(),this.formatPublishAt(),this.loading.isLoading=!1}},d=e=>(T("data-v-04787106"),e=e(),z(),e),be={key:0,class:"row text-break vl-parent px-sm-5",style:{"background-color":"var(--background_main)"}},xe={class:"col-12 col-lg-7 col-xl-8",style:{"background-color":"var(--background_main)"}},Se={class:""},Ae={class:"p-0 fs-4"},Ve={class:""},Ie={class:""},Le={class:"w-100 d-flex flex-column flex-sm-row justify-content-around align-items-center my-4 gap-2 text-center"},Oe={class:"d-flex gap-5 align-items-center justify-content-between justify-content-sm-start col-12 col-sm-9"},Be={class:"fs-5"},De=d(()=>s("i",{class:"fa-solid fa-eye btn-reacte rounded-4"},null,-1)),Pe={class:"fs-5"},Re={key:0},Ue={class:"fs-5"},je=d(()=>s("span",null,"Favorite",-1)),Fe={key:0},Ne=d(()=>s("span",{class:"me-2"},"Less",-1)),Te=d(()=>s("i",{class:"fa-solid fa-caret-up"},null,-1)),ze=[Ne,Te],Ee={key:1},Me=d(()=>s("span",{class:"me-2"},"More",-1)),qe=d(()=>s("i",{class:"fa-solid fa-caret-down"},null,-1)),He=[Me,qe],Ke={class:"row justify-content-center"},Ye={key:0,class:"rounded-2 p-3 mb-3",style:{"background-color":"var(--bg_detail_video)"}},Ge={class:""},We=d(()=>s("i",{class:"fa-solid fa-calendar-days"},null,-1)),Je={key:0,style:{"white-space":"pre-line"}},Qe={key:1,class:"float-end d-flex gap-2 align-items-center"},Xe=d(()=>s("span",null,"Allow comment",-1)),Ze={class:"switch"},$e=["checked"],et=d(()=>s("span",null,null,-1)),tt={key:1,class:"col-sm-12 my-4"},ot={key:2,class:"col-sm-12 my-4 text-center"},st=d(()=>s("span",{class:"fs-5"},"Blocked comment",-1)),it=[st],nt={class:"col-12 col-lg-5 col-xl-4 p-0 m-0"};function at(e,t,a,h,o,u){const g=m("Artplayer"),k=m("ProfileCard"),x=m("RouterLink"),i=m("Comment"),w=m("VideoCard"),L=m("loading");return o.video?(n(),l("div",be,[s("div",xe,[o.urlVideo?(n(),f(g,{key:0,option:o.option,style:O(o.style)},null,8,["option","style"])):c("",!0),s("div",Se,[s("p",Ae,r(o.video.title),1),s("div",Ve,[s("p",Ie,[o.video.accountId?(n(),f(x,{key:0,to:{name:"profile",params:{accountId:o.video.accountId._id}}},{default:y(()=>[p(k,{account:o.video.accountId},null,8,["account"])]),_:1},8,["to"])):c("",!0)]),s("div",Le,[s("div",Oe,[s("div",Be,[De,C("Â  "),s("span",null,r(o.video.viewCount),1)]),s("div",Pe,[s("i",{class:A(["fa-solid fa-heart btn-reacte rounded-4",{like:o.liked}]),onClick:t[0]||(t[0]=_=>u.handleLike())},null,2),C("Â  "),o.video.usersLike?(n(),l("span",Re,r(o.video.usersLike.length),1)):c("",!0)]),s("div",Ue,[s("i",{class:"fa-solid fa-folder-plus btn-reacte rounded-4",onClick:t[1]||(t[1]=_=>u.addFavoriteVideo(o.video._id))}),C("Â  "),je])]),s("button",{class:"col-3 p-2 mb-3 text-center rounded-3 fs-5",style:{"background-color":"var(--btn)",color:"var(--text)"},onClick:t[2]||(t[2]=_=>o.isShow=!o.isShow)},[o.isShow?(n(),l("span",Fe,ze)):(n(),l("span",Ee,He))])]),s("div",Ke,[p(B,{name:"bounce"},{default:y(()=>[o.isShow?(n(),l("div",Ye,[s("p",Ge,[We,C("Â  "+r(o.video.publishedAt),1)]),o.video.description&&o.video.description!=="undefined"?(n(),l("p",Je,r(o.video.description),1)):c("",!0)])):c("",!0)]),_:1})])])]),o.video.accountId&&o.video.accountId._id===h.accountStore.account._id?(n(),l("div",Qe,[Xe,s("label",Ze,[s("input",{type:"checkbox",checked:o.allowComment,onClick:t[3]||(t[3]=(..._)=>u.handleAllowComment&&u.handleAllowComment(..._))},null,8,$e),et])])):c("",!0),p(B,{name:"bounce"},{default:y(()=>[o.video.allowComment&&o.allowComment?(n(),l("div",tt,[(n(),f(i,{key:o.video._id,video:o.video,accountId:o.video.accountId._id},null,8,["video","accountId"]))])):(n(),l("div",ot,it))]),_:1})]),s("div",nt,[p(w,{class:A(this.$route.name==="detail"?"customArtplayer":""),videos:o.relaviteVideos,option:o.optionRelativeVideo,style:O(o.styleRelativeVideo)},null,8,["class","videos","option","style"])]),p(L,{active:o.loading.isLoading,"onUpdate:active":t[4]||(t[4]=_=>o.loading.isLoading=_),"can-cancel":!1,backgroundColor:"#170f23 !important",color:"#c6bcd3",opacity:.6,loader:"bars","is-full-page":o.loading.isFullPage},null,8,["active","is-full-page"])])):c("",!0)}const ht=R(Ce,[["render",at],["__scopeId","data-v-04787106"]]);export{ht as default};
